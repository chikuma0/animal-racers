(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7560:function(e,t,a){Promise.resolve().then(a.bind(a,1523)),Promise.resolve().then(a.bind(a,49)),Promise.resolve().then(a.bind(a,3641))},3641:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var l=a(7437),n=a(2265);let r=(0,a(3053).eI)("https://dcmdcubrgccmzabmyhrb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRjbWRjdWJyZ2NjbXphYm15aHJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzUxODMzOTksImV4cCI6MjA1MDc1OTM5OX0.K2FV1L796PCWAei-t87ojd4JwZ2FhBT50gf9wwg0X4U",{realtime:{params:{eventsPerSecond:15}}});class i{generateId(){return Math.random().toString(36).substring(2,10)}generateRoomCode(){return Math.floor(1e3+9e3*Math.random()).toString()}getPlayerId(){return this.playerId}getRoomCode(){return this.roomCode}async joinRoom(e){this.roomCode=e,this.channel&&await r.removeChannel(this.channel),this.channel=r.channel("room-".concat(e),{config:{broadcast:{self:!1}}}),this.channel.on("broadcast",{event:"game"},e=>{let t=e.payload;if(t.senderId!==this.playerId){for(let e of this.listeners.get(t.type)||[])e(t);for(let e of this.listeners.get("all")||[])e(t)}}),await this.channel.subscribe()}broadcast(e,t){this.channel&&this.channel.send({type:"broadcast",event:"game",payload:{type:e,senderId:this.playerId,data:t}})}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e){this.listeners.delete(e)}async disconnect(){this.channel&&(await r.removeChannel(this.channel),this.channel=null),this.listeners.clear()}broadcastPosition(e){this.broadcast("player_update",{x:e.x,progress:e.progress,lap:e.lap,speed:e.speed,boosting:e.boosting,jumping:e.jumping,frozen:e.frozen,shielded:e.shielded,hitStun:e.hitStun,finished:e.finished,finishTime:e.finishTime,battleFinished:e.battleFinished,battleFinishTime:e.battleFinishTime,character:e.character,name:e.name})}broadcastJoin(e){this.broadcast("player_join",{name:e})}broadcastReady(){this.broadcast("player_ready",{})}broadcastCharacterPick(e){this.broadcast("character_pick",{character:e})}broadcastStartGame(){this.broadcast("start_game",{startTime:Date.now()+4e3})}broadcastPhaseChange(e){this.broadcast("phase_change",{phase:e})}broadcastAttack(e,t){this.broadcast("attack",{character:e,targetId:t})}broadcastLapComplete(e){this.broadcast("lap_complete",{lap:e})}broadcastRaceFinish(e){this.broadcast("race_finish",{finishTime:e})}broadcastBattleFinish(e){this.broadcast("battle_finish",{battleFinishTime:e})}constructor(){this.channel=null,this.roomCode="",this.listeners=new Map,this.playerId=this.generateId()}}let s={lion:{id:"lion",name:"Fire Lion",emoji:"\uD83E\uDD81",color:"#FF4444",secondaryColor:"#FF8800",attackName:"Fire Dash",attackDesc:"Burst forward & knock others aside!"},wolf:{id:"wolf",name:"Water Wolf",emoji:"\uD83D\uDC3A",color:"#4488FF",secondaryColor:"#00CCFF",attackName:"Ice Howl",attackDesc:"Freeze nearest opponent for 1s!"},unicorn:{id:"unicorn",name:"Rainbow Unicorn",emoji:"\uD83E\uDD84",color:"#CC44FF",secondaryColor:"#FF88DD",attackName:"Rainbow Shield",attackDesc:"Block the next incoming attack!"}},o={WIDTH:360,VISIBLE_HEIGHT:640,LANE_COUNT:5,TRACK_LEFT:30,TRACK_RIGHT:330,LAP_LENGTH:4e3,RACE_LAPS:5,BATTLE_LAPS:1,BASE_SPEED:2.5,BOOST_SPEED:5,BOOST_DURATION:500,BOOST_COOLDOWN:3e3,JUMP_DURATION:600,JUMP_COOLDOWN:1500,FREEZE_DURATION:1e3,HIT_STUN_DURATION:800,HIT_SLOW_FACTOR:.3,OBSTACLE_INTERVAL:400,PLAYER_SIZE:36};function c(e){var t;let a=[],l=(t=e,function(){t|=0;let e=Math.imul((t=t+1831565813|0)^t>>>15,1|t);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/4294967296});for(let e=0;e<o.LAP_LENGTH;e+=o.OBSTACLE_INTERVAL){let t=e+l()*o.OBSTACLE_INTERVAL*.5,n=l()>.5?"rock":"river",r=.15+.7*l(),i=.15+.2*l();a.push({type:n,x:r,y:t,width:i})}return a}class d{resetTrack(e){this.trackSeed=e,this.obstacles=c(e),this.particles=[],this.screenShake=0}updatePlayer(e,t,a,l,n,r,i){let s={...e};if(s.frozen)return s;let c=o.BASE_SPEED;s.hitStun>0&&(c*=o.HIT_SLOW_FACTOR,s.hitStun-=t,s.hitStun<0&&(s.hitStun=0)),s.boosting&&(c=o.BOOST_SPEED),s.progress+=c*t*.06,s.speed=c,s.x+=.0015*t*a,s.x=Math.max(.05,Math.min(.95,s.x));let d=o.LAP_LENGTH,h=r?o.BATTLE_LAPS:o.RACE_LAPS;if(s.progress>=d&&(s.progress-=d,s.lap+=1,s.lap>=h&&(r?(s.battleFinished=!0,s.battleFinishTime=i):(s.finished=!0,s.finishTime=i))),!s.jumping){let e=s.progress%d;for(let t of this.obstacles)30>Math.abs(e-t.y)&&Math.abs(s.x-t.x)<t.width/2+.05&&("rock"===t.type?(s.x+=s.x>t.x?.08:-.08,s.speed*=.5,s.hitStun=300,this.addShake(5)):"river"===t.type&&(s.speed*=.3,s.hitStun=500))}return s}addShake(e){this.screenShake=Math.max(this.screenShake,e)}addParticles(e,t,a,l){for(let n=0;n<l;n++)this.particles.push({x:e,y:t,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4-2,life:1,maxLife:.5+.5*Math.random(),color:a,size:3+5*Math.random()})}updateParticles(e){let t=e/1e3;this.particles=this.particles.filter(e=>(e.x+=e.vx,e.y+=e.vy,e.life-=t/e.maxLife,e.size*=.98,e.life>0)),this.screenShake*=.9,this.screenShake<.5&&(this.screenShake=0)}constructor(){this.particles=[],this.screenShake=0,this.trackSeed=42,this.obstacles=c(this.trackSeed)}}function h(e,t,a,l){e.fillStyle="#5D3E1A",e.fillRect(t-4*l,a-5*l,8*l,20*l),e.fillStyle="#2E8B2E",e.beginPath(),e.arc(t,a-8*l,14*l,0,2*Math.PI),e.fill(),e.fillStyle="#3DA03D",e.beginPath(),e.arc(t-4*l,a-5*l,10*l,0,2*Math.PI),e.fill()}function u(e,t,a,l){e.fillStyle="#228B22",e.beginPath(),e.arc(t,a,8*l,0,2*Math.PI),e.fill(),e.fillStyle="#32CD32",e.beginPath(),e.arc(t+3*l,a-2*l,5*l,0,2*Math.PI),e.fill()}function f(e,t,a,l,n,r,i,c){let d=o.TRACK_LEFT*r,h=(o.TRACK_RIGHT-o.TRACK_LEFT)*r,u=d+t.x*h,f=t.progress-n%o.LAP_LENGTH,m=i?.65*l:l-f*r-.3*l,x=i?d+t.x*h:u;if(!i&&(m<-50||m>l+50))return;let b=t.character?s[t.character]:null;if(!b)return;let p=o.PLAYER_SIZE*r;if(e.save(),e.translate(x,m),t.jumping&&(e.translate(0,-15*r),e.fillStyle="#00000033",e.beginPath(),e.ellipse(0,15*r,p/2,p/4,0,0,2*Math.PI),e.fill()),t.frozen&&(e.fillStyle="#88CCFF44",e.beginPath(),e.arc(0,0,.8*p,0,2*Math.PI),e.fill()),t.shielded){e.strokeStyle="#FF88FF88",e.lineWidth=3,e.beginPath(),e.arc(0,0,.8*p,0,2*Math.PI),e.stroke();let t=.5*Date.now()%360;e.strokeStyle="hsla(".concat(t,", 100%, 70%, 0.5)"),e.beginPath(),e.arc(0,0,.85*p,0,2*Math.PI),e.stroke()}if(t.boosting){let t=b.color;for(let a=0;a<5;a++)e.fillStyle=t+Math.floor(40-8*a).toString(16).padStart(2,"0"),e.beginPath(),e.arc((Math.random()-.5)*10,p/2+8*a,p/3-2*a,0,2*Math.PI),e.fill()}let g=e.createRadialGradient(0,-(.1*p),.1*p,0,0,p/2);g.addColorStop(0,b.secondaryColor),g.addColorStop(1,b.color),e.fillStyle=g,e.beginPath(),e.arc(0,0,p/2,0,2*Math.PI),e.fill(),e.strokeStyle="#ffffff88",e.lineWidth=2,e.stroke(),e.font="".concat(.7*p,"px serif"),e.textAlign="center",e.textBaseline="middle",e.fillText(b.emoji,0,0),t.hitStun>0&&(e.fillStyle="#FF000044",e.beginPath(),e.arc(0,0,p/2,0,2*Math.PI),e.fill()),i||(e.fillStyle="#ffffffcc",e.font="bold ".concat(12*r,"px sans-serif"),e.textAlign="center",e.fillText(t.name,0,-p/2-8*r)),i&&(e.fillStyle="#ffffff44",e.beginPath(),e.moveTo(0,-p/2-5),e.lineTo(-6,-p/2-12),e.lineTo(6,-p/2-12),e.closePath(),e.fill()),e.restore()}function m(e,t){return{id:e,name:t,character:null,ready:!1,x:.5,progress:0,lap:0,speed:0,boosting:!1,jumping:!1,frozen:!1,shielded:!1,hitStun:0,finished:!1,finishTime:0,battleFinished:!1,battleFinishTime:0,attackCooldown:0}}function x(){let[e,t]=(0,n.useState)("home"),[a,r]=(0,n.useState)(""),[c,x]=(0,n.useState)(""),[b,p]=(0,n.useState)(""),[g,y]=(0,n.useState)(!1),[T,S]=(0,n.useState)(null),[v,w]=(0,n.useState)({}),[D,j]=(0,n.useState)(null),[N,C]=(0,n.useState)(new Set),[E,I]=(0,n.useState)(new Set),[k,P]=(0,n.useState)([]),[R,F]=(0,n.useState)([]),[,A]=(0,n.useState)(0),[_,L]=(0,n.useState)(!1),M=(0,n.useRef)(null),O=(0,n.useRef)(null),B=(0,n.useRef)(new d),H=(0,n.useRef)(0),W=(0,n.useRef)(0),z=(0,n.useRef)(0),U=(0,n.useRef)(!1),G=(0,n.useRef)(!1),J=(0,n.useRef)(0),K=(0,n.useRef)(0),V=(0,n.useRef)(null),Y=(0,n.useRef)({}),Z=(0,n.useRef)("home"),X=(0,n.useRef)(null),q=(0,n.useRef)(null),Q=(0,n.useRef)(0);(0,n.useEffect)(()=>{V.current=T},[T]),(0,n.useEffect)(()=>{Y.current=v},[v]),(0,n.useEffect)(()=>{Z.current=e},[e]),(0,n.useEffect)(()=>(O.current=new i,()=>{var e;null===(e=O.current)||void 0===e||e.disconnect(),X.current&&clearInterval(X.current)}),[]);let $=(0,n.useCallback)(()=>{let e=O.current;e&&(e.on("player_join",e=>{let t=e.data.name,a=m(e.senderId,t);w(t=>({...t,[e.senderId]:a}))}),e.on("character_pick",e=>{let t=e.data.character;w(a=>({...a,[e.senderId]:{...a[e.senderId],character:t}})),C(e=>new Set([...e,t]))}),e.on("player_ready",e=>{I(t=>new Set([...t,e.senderId]))}),e.on("start_game",e=>{let t=e.data.startTime;A(t),ei(t)}),e.on("player_update",e=>{w(t=>({...t,[e.senderId]:{...t[e.senderId],...e.data,id:e.senderId}}))}),e.on("attack",e=>{ee(e)}),e.on("phase_change",e=>{let a=e.data.phase;"battle"===a?er():"results"===a&&t("results")}),e.on("race_finish",e=>{let t=e.data.finishTime,a=Y.current[e.senderId];a&&P(e=>[...e,{name:a.name,character:a.character,time:t}])}),e.on("battle_finish",e=>{let t=e.data.battleFinishTime,a=Y.current[e.senderId];a&&F(e=>[...e,{name:a.name,character:a.character,time:t}])}))},[]),ee=e=>{let t=e.data.character,a=V.current;a&&("lion"===t?a.shielded?S(e=>e?{...e,shielded:!1}:e):(S(e=>e?{...e,hitStun:o.HIT_STUN_DURATION,x:Math.max(.1,Math.min(.9,e.x+(Math.random()>.5?.15:-.15)))}:e),B.current.addShake(10)):"wolf"===t&&(a.shielded?S(e=>e?{...e,shielded:!1}:e):(S(e=>e?{...e,frozen:!0}:e),setTimeout(()=>{S(e=>e?{...e,frozen:!1}:e)},o.FREEZE_DURATION))))};(0,n.useEffect)(()=>{let e=e=>{null!==e.gamma&&(z.current=Math.max(-1,Math.min(1,e.gamma/30)))};return(async()=>{if("function"==typeof DeviceOrientationEvent.requestPermission)try{let t=await DeviceOrientationEvent.requestPermission();"granted"===t&&window.addEventListener("deviceorientation",e)}catch(e){}else window.addEventListener("deviceorientation",e)})(),()=>{window.removeEventListener("deviceorientation",e)}},[]);let et=(0,n.useCallback)(e=>{let t=e.touches[0];t&&(q.current=t.clientX)},[]),ea=(0,n.useCallback)(e=>{if(null===q.current)return;let t=e.touches[0];if(t){let e=t.clientX-q.current;z.current=Math.max(-1,Math.min(1,e/50))}},[]),el=(0,n.useCallback)(()=>{q.current=null,z.current=0},[]),en=(0,n.useCallback)(e=>{if(!M.current||!V.current){H.current=requestAnimationFrame(en);return}let t=W.current?Math.min(e-W.current,50):16;W.current=e;let a=Date.now(),l=M.current.getContext("2d");if(!l)return;let n=B.current,r=V.current,i=Z.current,c="battle"===i;if(("racing"===i||c)&&!r.finished&&!(c&&r.battleFinished)){var d,m,x;if(U.current&&J.current<=0){r={...r,boosting:!0},J.current=o.BOOST_COOLDOWN,setTimeout(()=>{S(e=>e?{...e,boosting:!1}:e)},o.BOOST_DURATION);let e=r.character?s[r.character]:null;e&&n.addParticles(r.x*o.WIDTH,.65*o.VISIBLE_HEIGHT,e.color,8),n.addShake(3),U.current=!1}if(J.current=Math.max(0,J.current-t),G.current&&K.current<=0&&(r={...r,jumping:!0},K.current=o.JUMP_COOLDOWN,setTimeout(()=>{S(e=>e?{...e,jumping:!1}:e)},o.JUMP_DURATION),G.current=!1),K.current=Math.max(0,K.current-t),c&&r.character&&(Q.current-=t,Q.current<=0&&(Q.current=4e3,null===(d=O.current)||void 0===d||d.broadcastAttack(r.character),"unicorn"===r.character&&(r={...r,shielded:!0}),"lion"===r.character&&(r={...r,boosting:!0},setTimeout(()=>{S(e=>e?{...e,boosting:!1}:e)},300),n.addShake(5)),r.character))){let e=s[r.character];n.addParticles(r.x*o.WIDTH,.65*o.VISIBLE_HEIGHT,e.color,12)}(r=n.updatePlayer(r,t,z.current,r.boosting,r.jumping,c,a)).finished&&!c&&(null===(m=O.current)||void 0===m||m.broadcastRaceFinish(r.finishTime),P(e=>e.find(e=>e.name===r.name)?e:[...e,{name:r.name,character:r.character,time:r.finishTime}])),r.battleFinished&&c&&(null===(x=O.current)||void 0===x||x.broadcastBattleFinish(r.battleFinishTime),F(e=>e.find(e=>e.name===r.name)?e:[...e,{name:r.name,character:r.character,time:r.battleFinishTime}])),S(r)}n.updateParticles(t);let b=Object.values(Y.current);!function(e,t,a,l,n,r,i){let s=t.width,c=t.height,d=s/o.WIDTH,m=a.screenShake*(Math.random()-.5)*2,x=a.screenShake*(Math.random()-.5)*2;e.save(),e.translate(m,x);let b=l.progress;for(let t of(e.fillStyle="#1a5c1a",e.fillRect(0,0,s,c),function(e,t,a,l,n){let r=120*Math.floor(l/120)-120;for(let t=r;t<l+a/n+120;t+=120){let r=a-(t-l)*n-.3*a;h(e,15*n,r,n),h(e,(o.WIDTH-15)*n,r,n);let i=r+120*n*.5;u(e,10*n,i,.6*n),u(e,(o.WIDTH-10)*n,i,.6*n)}}(e,0,c,b,d),function(e,t,a,l,n){let r=o.TRACK_LEFT*n,i=o.TRACK_RIGHT*n,s=i-r;e.fillStyle="#8B7355",e.fillRect(r-4*n,0,s+8*n,a),e.fillStyle="#c4a060",e.fillRect(r,0,s,a),e.strokeStyle="#ffffff44",e.lineWidth=2,e.setLineDash([15,15]);let c=o.LANE_COUNT;for(let t=1;t<c;t++){let i=r+s/c*t,o=l*n%30;e.beginPath();for(let t=-30+o;t<a+30;t+=30)e.moveTo(i,t),e.lineTo(i,t+15);e.stroke()}e.setLineDash([]),e.strokeStyle="#ffffff88",e.lineWidth=3,e.beginPath(),e.moveTo(r,0),e.lineTo(r,a),e.stroke(),e.beginPath(),e.moveTo(i,0),e.lineTo(i,a),e.stroke();let d=a-(0-l%o.LAP_LENGTH)*n-.3*a;if(d>-20&&d<a+20){e.fillStyle="#ffffff";for(let t=0;t<10;t++){let a=r+s/10*t,l=s/10;e.fillStyle=t%2==0?"#ffffff":"#333333",e.fillRect(a,d-4,l,8)}}}(e,0,c,b,d),function(e,t,a,l,n,r,i){let s=o.TRACK_LEFT*r,c=(o.TRACK_RIGHT-o.TRACK_LEFT)*r;for(let a of t){let t=l-(a.y-n%o.LAP_LENGTH)*r-.3*l;if(t<-50||t>l+50)continue;let i=s+a.x*c,d=a.width*c;if("rock"===a.type)e.fillStyle="#666666",e.beginPath(),e.ellipse(i,t,d/2,d/3,0,0,2*Math.PI),e.fill(),e.fillStyle="#888888",e.beginPath(),e.ellipse(i-.1*d,t-.1*d,d/3,d/4,0,0,2*Math.PI),e.fill(),e.fillStyle="#aaaaaa44",e.beginPath(),e.ellipse(i-.15*d,t-.15*d,d/5,d/6,0,0,2*Math.PI),e.fill();else{e.fillStyle="#4488CC88",e.fillRect(i-d/2,t-10,d,20),e.strokeStyle="#66BBFF88",e.lineWidth=2,e.beginPath();for(let a=i-d/2;a<i+d/2;a+=8){let l=t+3*Math.sin((a+.003*Date.now())*.3);a===i-d/2?e.moveTo(a,l):e.lineTo(a,l)}e.stroke()}}}(e,a.obstacles,0,c,b,d,0),n))t.character&&f(e,t,s,c,b,d,!1,r);l.character&&f(e,l,s,c,b,d,!0,r),function(e,t,a,l,n,r){for(let a of t)e.globalAlpha=a.life,e.fillStyle=a.color,e.beginPath(),e.arc(a.x*r,a.y*r,a.size*r,0,2*Math.PI),e.fill();e.globalAlpha=1}(e,a.particles,0,0,0,d),function(e,t,a,l,n){e.fillStyle="#00000088",e.fillRect(0,0,t,50);let r=n?o.BATTLE_LAPS:o.RACE_LAPS,i=n?"⚔️ BATTLE LAP ".concat(Math.min(l.lap+1,r),"/").concat(r):"\uD83C\uDFC1 Lap ".concat(Math.min(l.lap+1,r),"/").concat(r);e.fillStyle=n?"#FF4444":"#ffffff",e.font="bold ".concat(18,"px sans-serif"),e.textAlign="left",e.fillText(i,12,32);let s=Math.round(l.speed/o.BOOST_SPEED*100);e.fillStyle="#ffffff",e.font="".concat(14,"px sans-serif"),e.textAlign="right",e.fillText("".concat(s,"%"),t-12,32);let c=t-12-60;e.fillStyle="#333333",e.fillRect(c,12,60,6),e.fillStyle=l.boosting?"#FFAA00":"#44FF44",e.fillRect(c,12,s/100*60,6)}(e,s,0,l,r),i&&function(e,t,a,l){e.fillStyle="#00000066",e.fillRect(0,0,t,a),e.fillStyle="#ffffff",e.font="bold 72px sans-serif",e.textAlign="center",e.textBaseline="middle";let n=1+.1*Math.sin(.01*Date.now());e.save(),e.translate(t/2,a/2),e.scale(n,n),e.fillText(l,0,0),e.restore()}(e,s,c,i),e.restore()}(l,M.current,n,r,b,c,D),H.current=requestAnimationFrame(en)},[D]);(0,n.useEffect)(()=>{if("racing"===e||"battle"===e||"countdown"===e)return H.current=requestAnimationFrame(en),()=>{cancelAnimationFrame(H.current)}},[e,en]),(0,n.useEffect)(()=>{if("racing"===e||"battle"===e)return X.current=setInterval(()=>{if(V.current){var e;null===(e=O.current)||void 0===e||e.broadcastPosition(V.current)}},100),()=>{X.current&&clearInterval(X.current)}},[e]),(0,n.useEffect)(()=>{let e=()=>{let e=M.current;if(!e)return;let t=window.devicePixelRatio||1,a=Math.min(window.innerWidth,420),l=window.innerHeight;e.width=a*t,e.height=l*t,e.style.width="".concat(a,"px"),e.style.height="".concat(l,"px");let n=e.getContext("2d");n&&n.scale(t,t)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,n.useEffect)(()=>{if("racing"===e&&(null==T?void 0:T.finished)){let e=Object.values(v).every(e=>e.finished),t=1+Object.keys(v).length;(e||k.length>=t)&&!_&&(L(!0),setTimeout(()=>{if(g){var e;null===(e=O.current)||void 0===e||e.broadcastPhaseChange("battle")}er()},2e3))}},[e,T,v,k,g,_]),(0,n.useEffect)(()=>{if("battle"===e&&(null==T?void 0:T.battleFinished)){let e=Object.values(v).every(e=>e.battleFinished),a=1+Object.keys(v).length;(e||R.length>=a)&&setTimeout(()=>{if(g){var e;null===(e=O.current)||void 0===e||e.broadcastPhaseChange("results")}t("results")},2e3)}},[e,T,v,R,g]);let er=()=>{L(!1),S(e=>e?{...e,progress:0,lap:0,speed:0,finished:!1,battleFinished:!1,battleFinishTime:0,hitStun:0,frozen:!1,boosting:!1,jumping:!1,shielded:!1}:e),Q.current=2e3,B.current.resetTrack(99),j("⚔️ BATTLE!"),t("battle"),setTimeout(()=>j("3"),1e3),setTimeout(()=>j("2"),2e3),setTimeout(()=>j("1"),3e3),setTimeout(()=>{j("GO!"),setTimeout(()=>j(null),500)},4e3)},ei=e=>{let a=e-Date.now();t("countdown"),S(e=>e?{...e,x:.5,progress:0,lap:0,speed:0,boosting:!1,jumping:!1,frozen:!1,shielded:!1,hitStun:0,finished:!1,finishTime:0,battleFinished:!1,battleFinishTime:0}:e),B.current.resetTrack(42),P([]),F([]),j("GET READY!"),setTimeout(()=>j("3"),Math.max(0,a-3e3)),setTimeout(()=>j("2"),Math.max(0,a-2e3)),setTimeout(()=>j("1"),Math.max(0,a-1e3)),setTimeout(()=>{j("GO! \uD83C\uDFC1"),t("racing"),setTimeout(()=>j(null),800)},a)};if("home"===e)return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-green-800 via-green-600 to-emerald-500 flex flex-col items-center justify-center p-6 text-white",children:[(0,l.jsx)("div",{className:"text-6xl mb-2 animate-bounce",children:"\uD83C\uDFCE️"}),(0,l.jsx)("h1",{className:"text-5xl font-extrabold mb-2 tracking-tight",style:{textShadow:"3px 3px 0 #000"},children:"ANIMAL"}),(0,l.jsx)("h1",{className:"text-5xl font-extrabold mb-6 tracking-tight",style:{textShadow:"3px 3px 0 #000"},children:"RACERS"}),(0,l.jsxs)("div",{className:"flex gap-4 text-4xl mb-8",children:[(0,l.jsx)("span",{className:"animate-pulse",children:"\uD83E\uDD81"}),(0,l.jsx)("span",{className:"animate-pulse",style:{animationDelay:"0.2s"},children:"\uD83D\uDC3A"}),(0,l.jsx)("span",{className:"animate-pulse",style:{animationDelay:"0.4s"},children:"\uD83E\uDD84"})]}),(0,l.jsx)("input",{type:"text",placeholder:"Your Name",value:b,onChange:e=>p(e.target.value.slice(0,10)),className:"w-64 p-3 mb-4 rounded-xl text-center text-xl font-bold bg-white/20 backdrop-blur border-2 border-white/40 text-white placeholder-white/60 outline-none focus:border-yellow-300",maxLength:10}),(0,l.jsx)("button",{onClick:async()=>{if(!b.trim())return;let e=O.current,a=e.generateRoomCode();r(a),y(!0),await e.joinRoom(a),$(),S(m(e.getPlayerId(),b.trim())),t("character-select")},disabled:!b.trim(),className:"w-64 p-4 mb-3 rounded-2xl text-xl font-bold bg-yellow-400 text-yellow-900 shadow-lg active:scale-95 transition-transform disabled:opacity-50 disabled:active:scale-100",children:"\uD83C\uDFE0 Create Room"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 w-64",children:[(0,l.jsx)("input",{type:"text",placeholder:"Code",value:c,onChange:e=>x(e.target.value.replace(/\D/g,"").slice(0,4)),className:"flex-1 p-3 rounded-xl text-center text-xl font-bold bg-white/20 backdrop-blur border-2 border-white/40 text-white placeholder-white/60 outline-none focus:border-yellow-300",maxLength:4,inputMode:"numeric"}),(0,l.jsx)("button",{onClick:async()=>{if(!b.trim()||4!==c.length)return;let e=O.current;r(c),y(!1),await e.joinRoom(c),$(),S(m(e.getPlayerId(),b.trim())),e.broadcastJoin(b.trim()),t("character-select")},disabled:!b.trim()||4!==c.length,className:"p-4 rounded-2xl text-xl font-bold bg-blue-400 text-blue-900 shadow-lg active:scale-95 transition-transform disabled:opacity-50",children:"Join"})]})]});if("character-select"===e)return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-purple-900 via-purple-700 to-indigo-600 flex flex-col items-center p-6 text-white",children:[(0,l.jsxs)("div",{className:"text-sm font-mono bg-black/30 px-3 py-1 rounded-full mb-4",children:["Room: ",(0,l.jsx)("span",{className:"font-bold text-yellow-300 text-lg",children:a})]}),(0,l.jsx)("h2",{className:"text-3xl font-extrabold mb-6",style:{textShadow:"2px 2px 0 #000"},children:"Choose Your Racer!"}),(0,l.jsx)("div",{className:"space-y-4 w-full max-w-sm",children:["lion","wolf","unicorn"].map(e=>{let t=s[e],a=N.has(e),n=(null==T?void 0:T.character)===e;return(0,l.jsxs)("button",{onClick:()=>{var t;a||n||(S(t=>t?{...t,character:e}:t),C(t=>new Set([...t,e])),null===(t=O.current)||void 0===t||t.broadcastCharacterPick(e))},disabled:a&&!n,className:"w-full p-4 rounded-2xl flex items-center gap-4 transition-all ".concat(n?"bg-yellow-400 text-yellow-900 scale-105 shadow-xl border-4 border-yellow-200":a?"bg-gray-600/50 text-gray-400":"bg-white/15 backdrop-blur active:scale-95 border-2 border-white/20"),children:[(0,l.jsx)("span",{className:"text-5xl",children:t.emoji}),(0,l.jsxs)("div",{className:"text-left flex-1",children:[(0,l.jsx)("div",{className:"text-xl font-bold",children:t.name}),(0,l.jsxs)("div",{className:"text-sm opacity-80",children:[t.attackName,": ",t.attackDesc]})]}),n&&(0,l.jsx)("span",{className:"text-2xl",children:"✅"}),a&&!n&&(0,l.jsx)("span",{className:"text-lg",children:"\uD83D\uDD12"})]},e)})}),(null==T?void 0:T.character)&&(0,l.jsx)("button",{onClick:()=>t("waiting"),className:"mt-6 w-64 p-4 rounded-2xl text-xl font-bold bg-green-400 text-green-900 shadow-lg active:scale-95 transition-transform animate-pulse",children:"Continue →"})]});if("waiting"===e){let e=[{id:null==T?void 0:T.id,name:null==T?void 0:T.name,character:null==T?void 0:T.character,ready:null==T?void 0:T.ready},...Object.values(v).map(e=>({id:e.id,name:e.name,character:e.character,ready:E.has(e.id)}))],t=e.filter(e=>e.ready||e.id===(null==T?void 0:T.id)&&(null==T?void 0:T.ready)).length,n=g&&t===e.length&&e.length>=1;return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-orange-700 via-orange-500 to-yellow-500 flex flex-col items-center p-6 text-white",children:[(0,l.jsxs)("div",{className:"text-sm font-mono bg-black/30 px-4 py-2 rounded-full mb-4",children:["Room Code: ",(0,l.jsx)("span",{className:"font-bold text-3xl text-yellow-200",children:a})]}),(0,l.jsx)("p",{className:"text-sm mb-4 opacity-80",children:"Share this code with other players!"}),(0,l.jsxs)("h2",{className:"text-2xl font-bold mb-4",children:["Players (",e.length,"/3)"]}),(0,l.jsx)("div",{className:"space-y-3 w-full max-w-sm mb-6",children:e.map((e,t)=>{let a=e.character?s[e.character]:null;return(0,l.jsxs)("div",{className:"flex items-center gap-3 bg-white/20 backdrop-blur rounded-xl p-3",children:[(0,l.jsx)("span",{className:"text-3xl",children:(null==a?void 0:a.emoji)||"❓"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"font-bold",children:[e.name," ",e.id===(null==T?void 0:T.id)?"(You)":""]}),(0,l.jsx)("div",{className:"text-sm opacity-80",children:(null==a?void 0:a.name)||"No character"})]}),(e.ready||e.id===(null==T?void 0:T.id)&&(null==T?void 0:T.ready))&&(0,l.jsx)("span",{className:"text-2xl",children:"✅"})]},t)})}),(null==T?void 0:T.ready)?(0,l.jsx)("div",{className:"text-lg font-bold text-green-200 animate-pulse",children:"Waiting for others..."}):(0,l.jsx)("button",{onClick:()=>{var e;S(e=>e?{...e,ready:!0}:e),null===(e=O.current)||void 0===e||e.broadcastReady()},className:"w-64 p-4 rounded-2xl text-xl font-bold bg-green-400 text-green-900 shadow-lg active:scale-95 transition-transform",children:"✋ Ready!"}),n&&(0,l.jsx)("button",{onClick:()=>{var e;let t=Date.now()+4e3;null===(e=O.current)||void 0===e||e.broadcastStartGame(),A(t),ei(t)},className:"mt-4 w-64 p-4 rounded-2xl text-xl font-bold bg-red-500 text-white shadow-lg active:scale-95 transition-transform animate-bounce",children:"\uD83C\uDFC1 START RACE!"})]})}if("results"===e){let e=[...k].sort((e,t)=>e.time-t.time),a=[...R].sort((e,t)=>e.time-t.time);return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-yellow-600 via-amber-500 to-orange-500 flex flex-col items-center p-6 text-white",children:[(0,l.jsx)("div",{className:"text-6xl mb-2",children:"\uD83C\uDFC6"}),(0,l.jsx)("h1",{className:"text-4xl font-extrabold mb-6",style:{textShadow:"2px 2px 0 #000"},children:"RESULTS!"}),(0,l.jsxs)("div",{className:"w-full max-w-sm mb-6",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-2 text-center",children:"\uD83C\uDFC1 Race"}),(0,l.jsx)("div",{className:"space-y-2",children:e.map((e,t)=>{let a=s[e.character];return(0,l.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-xl ".concat(0===t?"bg-yellow-300/40 border-2 border-yellow-200":"bg-white/15"),children:[(0,l.jsx)("span",{className:"text-2xl font-bold",children:0===t?"\uD83E\uDD47":1===t?"\uD83E\uDD48":"\uD83E\uDD49"}),(0,l.jsx)("span",{className:"text-3xl",children:a.emoji}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)("div",{className:"font-bold",children:e.name})}),0===t&&(0,l.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFC6"})]},t)})})]}),a.length>0&&(0,l.jsxs)("div",{className:"w-full max-w-sm mb-6",children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-2 text-center",children:"⚔️ Battle"}),(0,l.jsx)("div",{className:"space-y-2",children:a.map((e,t)=>{let a=s[e.character];return(0,l.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-xl ".concat(0===t?"bg-purple-300/40 border-2 border-purple-200":"bg-white/15"),children:[(0,l.jsx)("span",{className:"text-2xl font-bold",children:0===t?"\uD83E\uDD47":1===t?"\uD83E\uDD48":"\uD83E\uDD49"}),(0,l.jsx)("span",{className:"text-3xl",children:a.emoji}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)("div",{className:"font-bold",children:e.name})}),0===t&&(0,l.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFC6✨"})]},t)})})]}),(0,l.jsx)("button",{onClick:()=>{var e;t("home"),S(null),w({}),C(new Set),I(new Set),P([]),F([]),L(!1),null===(e=O.current)||void 0===e||e.disconnect()},className:"w-64 p-4 rounded-2xl text-xl font-bold bg-white/20 backdrop-blur border-2 border-white/40 active:scale-95 transition-transform",children:"\uD83C\uDFE0 Play Again"})]})}return(0,l.jsxs)("div",{className:"fixed inset-0 bg-black touch-none select-none",onTouchStart:et,onTouchMove:ea,onTouchEnd:el,children:[(0,l.jsx)("canvas",{ref:M,className:"block"}),("racing"===e||"battle"===e)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{onTouchStart:e=>{e.stopPropagation(),U.current=!0},className:"fixed bottom-8 left-6 w-20 h-20 rounded-full flex items-center justify-center text-3xl font-bold shadow-2xl active:scale-90 transition-transform ".concat(J.current>0?"bg-gray-600/80 text-gray-400":"bg-orange-500/90 text-white border-4 border-orange-300"),style:{WebkitTapHighlightColor:"transparent"},children:"\uD83D\uDD25"}),(0,l.jsx)("button",{onTouchStart:e=>{e.stopPropagation(),G.current=!0},className:"fixed bottom-8 right-6 w-20 h-20 rounded-full flex items-center justify-center text-3xl font-bold shadow-2xl active:scale-90 transition-transform ".concat(K.current>0?"bg-gray-600/80 text-gray-400":"bg-blue-500/90 text-white border-4 border-blue-300"),style:{WebkitTapHighlightColor:"transparent"},children:"⬆️"}),"battle"===e&&(0,l.jsx)("div",{className:"fixed top-14 left-1/2 -translate-x-1/2 bg-red-600/80 backdrop-blur px-4 py-1 rounded-full text-white font-bold text-lg animate-pulse",children:"⚔️ BATTLE MODE ⚔️"})]})]})}}},function(e){e.O(0,[221,971,117,744],function(){return e(e.s=7560)}),_N_E=e.O()}]);